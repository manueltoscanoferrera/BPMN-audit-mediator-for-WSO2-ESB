
<!-- definición del mediador 
   Definición del tag xml que iría en los proxys y secuencias
-->

<audit [version="1.0" ]>

	<businessProcess [id="string|{expression}" ]  [closeWithStatus="string|{expression}" 
	   [cascadeClose="true|false(default)"] [captureMsg="true|false(default)"]]>*
		<name value="string|{expression}" />*
		<description value="string|{expression}" />*
		<startTime value="string|{expression}" />* <!-- optional, autogenerated -->
		<endTime value="string|{expression}" />* <!-- optional, autogenerated -->
		<status value="string|{expression}" />* 
		<errorCode value="string|{expression}" />* <!-- optional, autogenerated -->
		<errorMessage value="string|{expression}" />* <!-- optional, autogenerated -->
		<errorDetail value="string|{expression}" />* <!-- optional, autogenerated -->
	</businessProcess>

	<task [id="string|{expression}"] new="true" [closeWithStatus="string|{expression}"]>
		<name value="string|{expression}" />*
		<description value="string|{expression}" />*
		<startTime value="string|{expression}" />* <!-- optional, autogenerated -->
		<endTime value="string|{expression}" />* <!-- optional, autogenerated -->
		<status value="string|{expression}" />*
		<errorCode value="string|{expression}" />* <!-- optional, autogenerated -->
		<errorMessage value="string|{expression}" />* <!-- optional, autogenerated -->
		<errorDetail value="string|{expression}" />* <!-- optional, autogenerated -->
		<inputParams>*
			<param nombre="string" value="string|{expression}"/>*
		</inputParams>
		<outputParams>*
			<param nombre="string" value="string|{expression}"/>*
		</outputParams>
	</task>
	
	<subProcess [id="string|{expression}"] new="true" [closeWithStatus="string|{expression}"]>
		<name value="string|{expression}" />*
		<description value="string|{expression}" />*
		<startTime value="string|{expression}" />* <!-- optional, autogenerated -->
		<endTime value="string|{expression}" />* <!-- optional, autogenerated -->
		<status value="string|{expression}" />*
		<errorCode value="string|{expression}" />* <!-- optional, autogenerated -->
		<errorMessage value="string|{expression}" />* <!-- optional, autogenerated -->
		<errorDetail value="string|{expression}" />* <!-- optional, autogenerated -->
		<inputParams>*
			<param nombre="string" value="string|{expression}"/>*
		</inputParams>
		<outputParams>*
			<param nombre="string" value="string|{expression}"/>*
		</outputParams>
	</subProcess>
	
	<receiveTask [id="string|{expression}"] new="true(default)|false" [closeWithStatus="string|{expression}" [captureMsg="true|false(default)"]]>
		<name value="string|{expression}" />*
		<description value="string|{expression}" />*
		<startTime value="string|{expression}" />* <!-- optional, autogenerated -->
		<endTime value="string|{expression}" />* <!-- optional, autogenerated -->
		<status value="string|{expression}" />*
		<errorCode value="string|{expression}" />* <!-- optional, autogenerated -->
		<errorMessage value="string|{expression}" />* <!-- optional, autogenerated -->
		<errorDetail value="string|{expression}" />* <!-- optional, autogenerated -->
		<inputParams>*
			<param nombre="string" value="string|{expression}"/>*
		</inputParams>
		<outputParams>*
			<param nombre="string" value="string|{expression}"/>*
		</outputParams>
		[<webService> | <jmsService>]
	</receiveTask>
		
	<sendTask [id="string|{expression}"] new="true" [closeWithStatus="string|{expression}" [captureMsg="true|false(default)"]]>
		<name value="string|{expression}" />*
		<description value="string|{expression}" />*
		<startTime value="string|{expression}" />* <!-- optional, autogenerated -->
		<endTime value="string|{expression}" />* <!-- optional, autogenerated -->
		<status value="string|{expression}" />*
		<errorCode value="string|{expression}" />* <!-- optional, autogenerated -->
		<errorMessage value="string|{expression}" />* <!-- optional, autogenerated -->
		<errorDetail value="string|{expression}" />* <!-- optional, autogenerated -->
		<inputParams>*
			<param nombre="string" value="string|{expression}"/>*
		</inputParams>
		<outputParams>*
			<param nombre="string" value="string|{expression}"/>*
		</outputParams>
		[<webService> | <jmsService>]
	</sendTask>

	
	<!-- comando para generar el XML de auditoría y guardarlo en el destino deseado --> 
	<serialize target="variable name" store="store name" media-type="xml (default) | json"/> <!-- la variable es INTERSAE_AUDIT -->
	
	</audit>
	
	
	<webService> 
		<endPoint value="string|{expression}" />*
		<operation value="string|{expression}" />*
		<type value="string|{expression}" />* 
		<idMessage value="string|{expression}" />* <!-- optional, autogenerated -->
		<msgRequest value="string|{expression}" | capture="true"/>*
		<msgResponse value="string|{expression}" | capture="true"/>*
		<replyTO value="string|{expression}"/>* <!-- optional, autogenerated -->
		<ipClient value="string|{expression}" />* <!-- optional, autogenerated -->
		<hostClient value="string|{expression}" />* <!-- optional, autogenerated -->
		<idClient value="string|{expression}" />* <!-- optional, autogenerated -->
		<ipServer value="string|{expression}" />* <!-- optional, autogenerated -->
		<hostServer value="string|{expression}" />* <!-- optional, autogenerated -->
	</webService>
	
	<jmsService> 
		<endPoint value="string|{expression}" />*
		<destination value="string|{expression}" />*
		<destinationType value="string|{expression}" />*<!--QUEUE | TOPIC -->
		<defaultReplyDestination value="string|{expression}" />*
		<defaultReplyDestinationType value="string|{expression}" />*<!--QUEUE | TOPIC -->
		<idMessage value="string|{expression}" />*
		<idCorrelation value="string|{expression}" />*
		<msgRequest value="string|{expression}" | capture="true"/>*
		<msgResponse value="string|{expression}" | capture="true"/>*
		<ipClient value="string|{expression}" />* <!-- optional, autogenerated -->
		<hostClient value="string|{expression}" />* <!-- optional, autogenerated -->
		<idClient value="string|{expression}" />* <!-- optional, autogenerated -->
		<ipServer value="string|{expression}" />* <!-- optional, autogenerated -->
		<hostServer value="string|{expression}" />* <!-- optional, autogenerated -->
	</jmsService>
	
	
	

<!-- examples  --> 

<!-- example 1, simple audit
 -->
 <!--  In sequence -->
 	<audit>
		<businessProcess id="5423">
			<name value="Consulta Demanda Por ID Abreviada"/>
			<description value="Consulta Demanda Por ID Abreviada"/>
		</businessProcess>
	</audit>

<!--  Out sequence -->
 	<audit>
		<businessProcess  closeWithStatus="OK"/>
	</audit>
	
<!--  Fault Sequence -->	
 	<audit>
		<businessProcess  closeWithStatus="ERROR"/>
	</audit>


<!-- Example 2, Auditing the WS operation-->
 <!--  In sequence -->
	<audit>
		<businessProcess id="5423">
			<name value="Consulta Demanda Por ID Abreviada"/>
			<description value="Consulta Demanda Por ID Abreviada"/>
		</businessProcess>
		<receiveTask>
		   <name value="WS consulta demanda por id Abreviada"/>
		   <webService>
		  	 <endPoint value="gov:/intersae/ProxyConsultaDemandaPorIDEP.xml"/>
		  	 <operation value="consultaDemandaPorID"/>
		   	 <msgRequest capture="true"/>  
		   </webService>
		</receiveTask>
	</audit>
	
	<!--  Out sequence -->
	<audit>
		<businessProcess closeWithStatus="OK" cascadeClose="true" captureMsg="true">
		</businessProcess>
	</audit>

    <!--  Fault Sequence -->	
 	<audit>
		<businessProcess  closeWithStatus="ERROR" cascadeClose="true" captureMsg="true"/>
	</audit>

<!--
Example 3 .- orquestation:
 1.- validate the msg
 2.- call external WS 1
 3.- call external WS 2
-->
	<!--  In sequence -->
	<audit>
		<businessProcess id="5423">
			<name value="Consulta Demanda Por ID Abreviada"/>
			<description value="Consulta Demanda Por ID Abreviada"/>
		</businessProcess>
		<receiveTask>
		   <name value="WS consulta demanda por id Abreviada"/>
		   <webService>
		  	 <endPoint value="gov:/intersae/ProxyConsultaDemandaPorIDEP.xml"/>
		  	 <operation value="consultaDemandaPorID"/>
		   	 <msgRequest capture="true"/>  
		   </webService>
		</receiveTask>
	</audit>

   <!-- before validation  -->
	<audit>
		<task id="validation">
			<name value="In msg validation"/>
		</task>
	</audit>
	
	<!--  if validation OK -->
	<audit>
		<task id="validation" closeWithStatus="OK"/>
	</audit>
	
	<!--  before call WS 1 -->
	
	<audit>
		<sendTask id="callWSValidarHermes">
			<name value="Invocación Validar Hermes"/>
			<webService>
		  	 	<endPoint value="gov:/intersae/HermesEP.xml"/>
		  	 	<operation value="validar"/>
		   	 	<msgRequest capture="true"/>  
		   	</webService>
		</sendTask>
	</audit>
<!--  if ws response OK -->
	<audit>
		<sendTask id="callWSValidarHermes" closeWithStatus="OK" captureMsg="true"/>
	</audit>

	<!--  before call WS 2 -->
	
	<audit>
		<sendTask id="callWSConsultaDemandaPorID">
			<name value="Consulta Demanda Por ID"/>
			<webService>
		  	 	<endPoint value="gov:/intersae/HermesEP.xml"/>
		  	 	<operation value="consultaDemandaPorID"/>
		   	 	<msgRequest capture="true"/>  
		   	</webService>
		</sendTask>
	</audit>
<!--  if ws response OK -->
	<audit>
		<sendTask id="callWSConsultaDemandaPorID" closeWithStatus="OK" captureMsg="true"/>
	</audit>
	
		<!--  Out sequence -->
	<audit>
		<businessProcess closeWithStatus="OK" cascadeClose="true" captureMsg="true">
		</businessProcess>
	</audit>

    <!--  Fault Sequence -->	
 	<audit>
		<businessProcess  closeWithStatus="ERROR" cascadeClose="true" captureMsg="true"/>
		<serialize store="errorMSGqueue"/>
	</audit>
	


<!-- ejemplo xml generado por audit en el comando Serialize -->
	
	<?xml version="1.0" encoding="UTF-8"?>
<int:businessProcessAudit version="0"
	xmlns:int="urn:org:codigolibre:businessprocessaudit:type:v1.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="urn:org:codigolibre:businessprocessaudit:type:v1.0.0 ../src/main/resources/businessProcessAudit.xsd ">
	<int:id>5024</int:id>
	<int:name>Consulta Demanda Por ID</int:name>
	<int:description>Proceso de Consulta Demanda Por ID</int:description>
	<int:startTime>2001-12-31T12:00:00</int:startTime>
	<int:endTime>2001-12-31T12:00:00</int:endTime>
	<int:status>OK</int:status>
	<int:activities>
		<int:receiveTaskAudit>
			<int:id>WSConsultaDemandaPorID</int:id>
			<int:name>WSConsultaDemandaPorID</int:name>
			<int:description>WSConsultaDemandaPorID</int:description>
			<int:startTime>2001-12-31T12:00:00</int:startTime>
			<int:endTime>2001-12-31T12:00:00</int:endTime>
			<int:status>OK</int:status>
			<int:webServiceAudit>
				<int:endPoint>gov:/intersaeEndpoint/WSConsultaDemandaPorID_BUS_EP.xml</int:endPoint>
				<int:operation>consultademandaporip</int:operation>
				<int:type>sincrono</int:type>
				<int:idMsg>jadjkljkljkljkljklsdfjkl</int:idMsg>
				<int:msgRequest>XML</int:msgRequest>
				<int:msgResponse>XML</int:msgResponse>
				<int:ipClient>10.240.240.240</int:ipClient>
				<int:hostClient>host</int:hostClient>
				<int:idClient>usuariopruebas1</int:idClient>
				<int:ipServer>10.240.240.241</int:ipServer>
				<int:hostServer>desesb1</int:hostServer>
			</int:webServiceAudit>
		</int:receiveTaskAudit>
		<int:taskAudit>
			<int:id>ValidaciónMsgEntrada</int:id>
			<int:name>ValidaciónMsgEntrada</int:name>
			<int:description>Validación Msg Entrada</int:description>
			<int:startTime>2001-12-31T12:00:00</int:startTime>
			<int:endTime>2001-12-31T12:00:00</int:endTime>
			<int:status>OK</int:status>
			<int:inputParams>
				<int:param name="petición">xml_a_validar</int:param>
			</int:inputParams>
		</int:taskAudit>
		<int:sendTaskAudit>
			<int:id>sendVAlidarHermes1</int:id>
			<int:name>validar hermers</int:name>
			<int:description>llamada a hermes para obtener el id del usuario</int:description>
			<int:startTime>2001-12-31T12:00:00</int:startTime>
			<int:endTime>2001-12-31T12:00:00</int:endTime>
			<int:status>OK</int:status>
			<int:inputParams>
				<int:param name="idUsuariohermes">sicas</int:param>
			</int:inputParams>
			<int:outputParams>
				<int:param name="idHermes">212331223</int:param>
			</int:outputParams>
			<int:webServiceAudit>
				<int:endPoint>gov:/intersaeEndpoints/hermesEP.xml</int:endPoint>
				<int:operation>validar</int:operation>
				<int:type>sincrono</int:type>
				<int:idMsg>jadjkljkljkljkljklsdfjkl</int:idMsg>
				<int:msgRequest>xml_req</int:msgRequest>
				<int:msgResponse>xml_resp</int:msgResponse>
				<int:ipClient>10.240.240.240</int:ipClient>
				<int:hostClient>desesb</int:hostClient>
				<int:idClient></int:idClient>
				<int:ipServer>10.240.240.220</int:ipServer>
				<int:hostServer>hermeshost</int:hostServer>
			</int:webServiceAudit>
		</int:sendTaskAudit>

		<int:sendTaskAudit>
			<int:id>send Consulta Demanda por ID Hermes1</int:id>
			<int:name>Consulta Demanda por ID Hermes</int:name>
			<int:description>llamada a hermes para obtener las demandas del usuario</int:description>
			<int:startTime>2001-12-31T12:00:00</int:startTime>
			<int:endTime>2001-12-31T12:00:00</int:endTime>
			<int:status>OK</int:status>
			<int:inputParams>
				<int:param name="idHermes">212331223</int:param>
			</int:inputParams>
			<int:webServiceAudit>
				<int:endPoint>gov:/intersaeEndpoints/hermesEP.xml</int:endPoint>
				<int:operation>consultademandaporid</int:operation>
				<int:type>sincrono</int:type>
				<int:idMsg>jadjkljkljkljkljklsdfjkl</int:idMsg>
				<int:msgRequest>xml_req</int:msgRequest>
				<int:msgResponse>xml_resp</int:msgResponse>
				<int:ipClient>10.240.240.240</int:ipClient>
				<int:hostClient>desesb</int:hostClient>
				<int:idClient></int:idClient>
				<int:ipServer>10.240.240.220</int:ipServer>
				<int:hostServer>hermeshost</int:hostServer>
			</int:webServiceAudit>
		</int:sendTaskAudit>
	</int:activities>
</int:businessProcessAudit>
